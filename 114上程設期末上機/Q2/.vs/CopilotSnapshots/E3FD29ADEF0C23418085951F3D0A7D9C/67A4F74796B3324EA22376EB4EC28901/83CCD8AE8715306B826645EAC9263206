using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Windows.Forms;

namespace Program6_5
{
    /// <summary>
    /// 汽車維修服務主表單
    /// </summary>
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        
        // 定義變數：機油、潤滑、水箱、變速箱、檢驗、更換、輪胎、
        // 零件、工時、稅金、總計
        decimal oil, lube, radiator, transmission, inspection, replace, tire, 
                parts, labor, tax, total;
        
        // 每小時工資費率
        const decimal LABOR_RATE_PER_HOUR = 600m;

        /// <summary>
        /// 計算總額按鈕事件
        /// </summary>
        private void button1_Click(object sender, EventArgs e)
        {
            // 計算零件和工時（確保 labor 已計算）
            OtherCharges();
            // 顯示服務和工時總額（工時 + 機油潤滑 + 清洗 + 其他）
            serviceLaborValueLabel.Text = (labor + OilLubeCharges() + FlushCharges() + MiscCharges()).ToString("C0");

            // 顯示零件費用
            if (partsTextBox.Text == "")
            {
                partsValueLabel.Text = 0m.ToString("C0");
            }
            else
            {
                partsValueLabel.Text = decimal.Parse(partsTextBox.Text).ToString("C0");
            }

            // 顯示稅金
            taxValueLabel.Text = TaxCharges().ToString("C0");
            // 顯示總費用
            totalFeesValueLabel.Text = TotalCharges().ToString("C0");
        }

        /// <summary>
        /// 計算機油和潤滑費用
        /// </summary>
        /// <returns>機油和潤滑的總費用</returns>
        private decimal OilLubeCharges()
        {
            // 如果選擇了更換機油，設定費用為 NT$780
            if (oilChangeCheckBox.Checked)
            {
                oil = 780m;
            }
            else
            {
                oil = 0m;
            }
            // 如果選擇了潤滑保養，設定費用為 NT$540
            if (lubeCheckBox.Checked)
            {
                lube = 540m;
            }
            else
            {
                lube = 0m;
            }

            return (oil + lube);
        }

        /// <summary>
        /// 計算清洗服務費用
        /// </summary>
        /// <returns>水箱和變速箱清洗的總費用</returns>
        private decimal FlushCharges()
        {
            // 如果選擇了水箱清洗，設定費用為 NT$900
            if (radiatorFlushCheckBox.Checked)
            {
                radiator = 900m;
            }
            else
            {
                radiator = 0m;
            }
            // 如果選擇了變速箱清洗，設定費用為 NT$2400
            if (transmissionFlushCheckBox.Checked)
            {
                transmission = 2400m;
            }
            else
            {
                transmission = 0m;
            }

            return (radiator + transmission);
        }

        /// <summary>
        /// 計算其他服務費用
        /// </summary>
        /// <returns>檢驗、更換消音器和輪胎換位的總費用</returns>
        private decimal MiscCharges()
        {
            // 如果選擇了檢驗，設定費用為 NT$450
            if (inspectionCheckBox.Checked)
            {
                inspection = 450m;
            }
            else
            {
                inspection = 0m;
            }
            // 如果選擇了更換消音器，設定費用為 NT$3000
            if (mufflerCheckBox.Checked)
            {
                replace = 3000m;
            }
            else
            {
                replace = 0m;
            }
            // 如果選擇了輪胎換位，設定費用為 NT$600
            if (tireRotationCheckBox.Checked)
            {
                tire = 600m;
            }
            else
            {
                tire = 0m;
            }
            return (inspection + replace + tire);
        }

        /// <summary>
        /// 計算零件和工時費用
        /// </summary>
        /// <returns>零件和工時的總費用</returns>
        private decimal OtherCharges()
        {
            // 嘗試從文字框解析零件費用，如果失敗則設為 0
            if (!decimal.TryParse(partsTextBox.Text, out parts))
            {
                parts = 0m;
            }
            // 嘗試從文字框解析工時數，如果失敗則設為 0
            decimal laborHours = 0m;
            if (!decimal.TryParse(laborTextBox.Text, out laborHours))
            {
                laborHours = 0m;
            }
            // 計算工資：工時數 × 每小時 NT$600
            labor = laborHours * LABOR_RATE_PER_HOUR;
            
            return (parts + labor);
        }
        /// <summary>
        /// 計算稅金（僅對零件收取 6% 稅）
        /// </summary>
        /// <returns>稅金</returns>
        private decimal TaxCharges()
        {
            // 如果零件費用解析成功，計算 6% 的稅金
            if (decimal.TryParse(partsTextBox.Text, out parts))
            {
                tax = parts * 0.06m;
            }
            else
            {
                tax = 0m;
            }
            return tax;
        }

        /// <summary>
        /// 計算所有費用的總和
        /// </summary>
        /// <returns>總費用</returns>
        private decimal TotalCharges()
        {
            // 總費用 = 機油潤滑 + 清洗 + 其他服務 + 零件工時 + 稅金
            total = OilLubeCharges() + FlushCharges() + MiscCharges() + OtherCharges() + TaxCharges();
            return total;
        }

        /// <summary>
        /// 清除按鈕事件，重設所有選項和輸入
        /// </summary>
        private void button2_Click(object sender, EventArgs e)
        {
            // 清除所有選擇框和文字框
            ClearOilLube();
            ClearFlushes();
            ClearMisc();
            ClearOther();
            ClearFees();
        }

        /// <summary>
        /// 清除機油和潤滑選項
        /// </summary>
        private void ClearOilLube()
        {
            oilChangeCheckBox.Checked = false;
            lubeCheckBox.Checked = false;
        }
        /// <summary>
        /// 清除清洗服務選項
        /// </summary>
        private void ClearFlushes()
        {
            radiatorFlushCheckBox.Checked = false;
            transmissionFlushCheckBox.Checked = false;
        }
        /// <summary>
        /// 清除其他服務選項
        /// </summary>
        private void ClearMisc()
        {
            inspectionCheckBox.Checked = false;
            mufflerCheckBox.Checked = false;
            tireRotationCheckBox.Checked = false;
        }
        /// <summary>
        /// 清除零件和工時輸入
        /// </summary>
        private void ClearOther()
        {
            partsTextBox.Text = "";
            laborTextBox.Text = "";
        }
        /// <summary>
        /// 清除費用顯示
        /// </summary>
        private void ClearFees()
        {
            serviceLaborValueLabel.Text = "";
            partsValueLabel.Text = "";
            taxValueLabel.Text = "";
            totalFeesValueLabel.Text = "";
        }

        /// <summary>
        /// 離開按鈕事件，關閉表單
        /// </summary>
        private void button3_Click(object sender, EventArgs e)
        {
            this.Close();
        }
    }
}
